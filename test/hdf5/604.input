*-------------------------------------------------------------------------------
* System: 2 PSB2 molecules
* Basis: ANO-R1
* Features tested: Frenkel exciton energies with hdf5 files
* Responsible person: I. Fdez. Galván, Luca De Vico
*-------------------------------------------------------------------------------
> IF ($MOLCAS_NPROCS != 1)
>   EXIT 36
> ENDIF

* Test HDF5 support
> RM -FORCE TEST_HDF5
> IF ( $MOLCAS_DRIVER = UNKNOWN_VARIABLE )
>   EXPORT MOLCAS_DRIVER=molcas
> ENDIF
> SHELL $MOLCAS_DRIVER have_feature hdf5 || touch TEST_HDF5
> IF ( -FILE TEST_HDF5 )
>   EXIT 36
> ENDIF

* Test also mort support
> IF ( -FILE $MOLCAS/Tools/mort/mort.py )
>   GOTO HAVE_MORT
> ENDIF
> EXIT 36
> LABEL HAVE_MORT
> SHELL sh create_test_numpy_h5py $MOLCAS/Tools/mort/mort.py
> SHELL ./test_numpy_h5py.py || touch TEST_NUMPY_H5PY
> IF ( -FILE TEST_NUMPY_H5PY )
>   EXIT 36
> ENDIF

>FILE create_test_numpy_h5py
head -n 1 $1 > test_numpy_h5py.py
echo "import numpy" >> test_numpy_h5py.py
echo "import h5py" >> test_numpy_h5py.py
chmod +x test_numpy_h5py.py
>EOF

> FILE PSB2-A.xyz
10

C         -1.03593        1.05292        0.0
C         -2.33477        0.74532        0.0
H         -2.66757       -0.28790        0.0
H         -3.07916        1.53468        0.0
C          0.00000        0.00000        0.0
H         -0.74127        2.09795        0.0
N          1.24994        0.30115        0.0
H         -0.29616       -1.04567        0.0
H          1.56256        1.28304        0.0
H          1.95992       -0.44520        0.0
> EOF

> FILE PSB2-B.xyz
10

C         -1.03593        1.05292        3.5
C         -2.33477        0.74532        3.5
H         -2.66757       -0.28790        3.5
H         -3.07916        1.53468        3.5
C          0.00000        0.00000        3.5
H         -0.74127        2.09795        3.5
N          1.24994        0.30115        3.5
H         -0.29616       -1.04567        3.5
H          1.56256        1.28304        3.5
H          1.95992       -0.44520        3.5
> EOF

> COPY PSB2-A.xyz .
> COPY PSB2-B.xyz .

***** SYSTEM A ******

&GATEWAY
  Coord = PSB2-A.xyz
  Basis = ANO-R1
  NoMove
  Group = NoSym
  RICD

&SEWARD

&SCF
  Charge = 1

&RASSCF
  File = $Project.scf.h5
  Charge = 1
  NActEl = 4
  RAS2 = 4
  StAverage = 3
  Alter = 2
    1 13 14
    1 17 20

&CASPT2
  File = $Project.rasscf.h5
  Multistate = all

> COPY $Project.caspt2.h5 MonA.caspt2.h5

* System B is identical but translated 3.5 Å
> EXEC $MOLCAS/Tools/mort/mort.py -t 0.0 0.0 6.6140414362 MonA.caspt2.h5 MonB.caspt2.h5

***** INTEGRALS OF A+B PART 1 ******

&GATEWAY
  Coord = PSB2-A.xyz
  Coord = PSB2-B.xyz
  BSSE = 1
  Basis = ANO-R1
  NoMove
  Group = NoSym
  RICD

&SEWARD

> COPY $Project.RunFile  AUXRFIL1

***** SYSTEM A ******

&GATEWAY
  Coord = PSB2-A.xyz
  Basis = ANO-R1
  NoMove
  Group = NoSym

&SEWARD
  FakeRICD

> COPY MonA.caspt2.h5 JOB001

&RASSI
  NrOfJobIph = 1 all
  TRD1
  TRDI
  MonA

***** INTEGRALS OF A+B PART 2 ******

&GATEWAY
  Coord = PSB2-A.xyz
  Coord = PSB2-B.xyz
  BSSE = 2
  Basis = ANO-R1
  NoMove
  Group = Nosym

&SEWARD
  FakeRICD

> COPY $Project.RunFile AUXRFIL2

***** SYSTEM B ******

&GATEWAY
  Coord = PSB2-B.xyz
  Basis = ANO-R1
  NoMove
  Group = Nosym

&SEWARD
  FakeRICD

> COPY MonB.caspt2.h5 JOB001

&RASSI
  NrOfJobIph = 1 all
  TRD1
  TRDI
  MonB
  Excitonics

>>FILE checkfile
* This file is autogenerated:
* Molcas version 25.10-141-g62b67eb38
* Linux lucia 6.8.0-90-generic #91~22.04.1-Ubuntu SMP PREEMPT_DYNAMIC Thu Nov 20 15:20:45 UTC 2 x86_64 x86_64 x86_64 GNU/Linux
* Mon Jan 12 08:50:30 2026
*
#>>   1
#> POTNUC="111.651187355554"/12
#>>   2
#> SEWARD_MLTPL1X="-1.073192068006"/5
#> SEWARD_KINETIC="23350.035000000014"/5
#> SEWARD_ATTRACT="-1202.220594042906"/5
#> POTNUC="111.651187355554"/12
#> SEWARD_MLTPL1X="-1.073192068006"/5
#> SEWARD_KINETIC="16.117924744635"/5
#> SEWARD_ATTRACT="-41.710995025252"/5
#>>   3
#> SCF_ITER="14"/8
#> E_SCF="-171.424417790771"/4
#> MLTPL__0="1"/2
#> MLTPL__1[0]="-0.040225995280"/2
#> MLTPL__1[1]="0.586768554669"/2
#> MLTPL__1[2]="-0.000000000000"/2
#> MLTPL__2[0]="12.417222822415"/2
#> MLTPL__2[1]="-2.292324437092"/2
#> MLTPL__2[2]="0.000000000000"/2
#> MLTPL__2[3]="-0.727302631790"/2
#> MLTPL__2[4]="0.000000000000"/2
#> MLTPL__2[5]="-11.689920190625"/2
#>>   4
#> RASSCF_ITER="11"/8
#> E_RASSCF[0]="-171.458318995752"/4
#> E_RASSCF[1]="-171.211699259471"/4
#> E_RASSCF[2]="-171.153757227006"/4
#> MLTPL__0="1"/2
#> MLTPL__1[0]="0.502434967757"/2
#> MLTPL__1[1]="0.543123215318"/2
#> MLTPL__1[2]="-0.000000000000"/2
#> MLTPL__2[0]="12.555691837657"/2
#> MLTPL__2[1]="-2.090101238691"/2
#> MLTPL__2[2]="-0.000000000000"/2
#> MLTPL__2[3]="-1.052769136107"/2
#> MLTPL__2[4]="0.000000000000"/2
#> MLTPL__2[5]="-11.502922701551"/2
#> MLTPL__0="1"/2
#> MLTPL__1[0]="-1.266338547121"/2
#> MLTPL__1[1]="1.383268976359"/2
#> MLTPL__1[2]="-0.000000000000"/2
#> MLTPL__2[0]="12.684396619811"/2
#> MLTPL__2[1]="-2.340642245222"/2
#> MLTPL__2[2]="0.000000000000"/2
#> MLTPL__2[3]="-1.424600437034"/2
#> MLTPL__2[4]="0.000000000000"/2
#> MLTPL__2[5]="-11.259796182776"/2
#> MLTPL__0="1"/2
#> MLTPL__1[0]="1.217486787406"/2
#> MLTPL__1[1]="0.745372498821"/2
#> MLTPL__1[2]="-0.000000000000"/2
#> MLTPL__2[0]="12.859398852744"/2
#> MLTPL__2[1]="-3.139663202817"/2
#> MLTPL__2[2]="0.000000000000"/2
#> MLTPL__2[3]="-1.199208048492"/2
#> MLTPL__2[4]="0.000000000000"/2
#> MLTPL__2[5]="-11.660190804252"/2
#>>   5
#> E_CASPT2="-171.991723905047"/4
#> E_CASPT2="-171.780368825088"/4
#> E_CASPT2="-171.691979629065"/4
#> E_MSPT2[0]="-171.992766270662"/4
#> E_MSPT2[1]="-171.785220023526"/4
#> E_MSPT2[2]="-171.686086065012"/4
#>>   6
#> POTNUC="111.651187355554"/12
#>>   7
#> SEWARD_MLTPL1X="-1.073192068006"/5
#> SEWARD_KINETIC="23350.035000000014"/5
#> SEWARD_ATTRACT="-4.224243148832"/5
#> POTNUC="111.651187355554"/12
#> SEWARD_MLTPL1X="-1.073192068006"/5
#> SEWARD_KINETIC="16.117924744635"/5
#> SEWARD_ATTRACT="-4.224243146142"/5
#>>   8
#> POTNUC="111.651187355554"/12
#>>   9
#> SEWARD_MLTPL1X="-1.073192068006"/5
#> SEWARD_KINETIC="23350.035000000014"/5
#> SEWARD_ATTRACT="-1202.220594042906"/5
#> POTNUC="111.651187355554"/12
#> SEWARD_MLTPL1X="-1.073192068006"/5
#> SEWARD_KINETIC="16.117924744635"/5
#> SEWARD_ATTRACT="-41.710995025252"/5
#>>  10
#> E_RASSI[0]="-171.992766270662"/7
#> E_RASSI[1]="-171.785220023526"/7
#> E_RASSI[2]="-171.686086065012"/7
#> TMS(SF,LEN)="0.657817813787"/6
#> TMS(SF,LEN)="0.084621402052"/6
#> TMS(SF,LEN)="0.004042085131"/6
#> TVC(SF,LEN)="2.180424243276"/6
#> TVC(SF,LEN)="0.643343422265"/6
#> TVC(SF,LEN)="0.247307412379"/6
#> TMS(SF,VEL)="0.654736725771"/6
#> TMS(SF,VEL)="0.080779020953"/6
#> TMS(SF,VEL)="0.022116109280"/6
#>>  11
#> POTNUC="111.651187355554"/12
#>>  12
#> SEWARD_MLTPL1X="-1.073192068006"/5
#> SEWARD_KINETIC="23350.035000000014"/5
#> SEWARD_ATTRACT="-1202.220594042906"/5
#> POTNUC="111.651187355554"/12
#> SEWARD_MLTPL1X="-1.073192068006"/5
#> SEWARD_KINETIC="16.117924744635"/5
#> SEWARD_ATTRACT="-41.710995025252"/5
#>>  13
#> POTNUC="111.651187355554"/12
#>>  14
#> SEWARD_MLTPL1X="-1.073192068006"/5
#> SEWARD_KINETIC="23350.035000000014"/5
#> SEWARD_ATTRACT="-1202.220594042906"/5
#> POTNUC="111.651187355554"/12
#> SEWARD_MLTPL1X="-1.073192068006"/5
#> SEWARD_KINETIC="16.117924744635"/5
#> SEWARD_ATTRACT="-41.710995025252"/5
#>>  15
#> E_RASSI[0]="-171.992766270662"/7
#> E_RASSI[1]="-171.785220023526"/7
#> E_RASSI[2]="-171.686086065012"/7
#> TMS(SF,LEN)="0.657817813787"/6
#> TMS(SF,LEN)="0.084621402052"/6
#> TMS(SF,LEN)="0.004042085131"/6
#> TVC(SF,LEN)="2.180424243276"/6
#> TVC(SF,LEN)="0.643343422265"/6
#> TVC(SF,LEN)="0.247307412379"/6
#> TMS(SF,VEL)="0.654736725771"/6
#> TMS(SF,VEL)="0.080779020953"/6
#> TMS(SF,VEL)="0.022116109280"/6
#> E_FRENKEL[0]="-0.010348551188"/6
#> E_FRENKEL[1]="5.227264444097"/6
#> E_FRENKEL[2]="5.717035416875"/6
#> E_FRENKEL[3]="8.299071116180"/6
#> E_FRENKEL[4]="8.444229205471"/6
#> FRENKEL_OSCSTR[0]="0.0"/6
#> FRENKEL_OSCSTR[1]="1.314118236900"/6
#> FRENKEL_OSCSTR[2]="0.0"/6
#> FRENKEL_OSCSTR[3]="0.190324903890"/6
#> FRENKEL_OSCSTR[4]="0.0"/6
#> FRENKEL_OSCSTR[5]="0.004558846627"/6
#> FRENKEL_OSCSTR[6]="0.0"/6
#> FRENKEL_OSCSTR[7]="0.0"/6
#> FRENKEL_OSCSTR[8]="0.002959708944"/6
#> FRENKEL_OSCSTR[9]="0.0"/6
>>EOF
