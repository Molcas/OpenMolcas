*-------------------------------------------------------------------------------
* Molecule: C2H2
* Basis: cc-pVDZ
* Symmetry: C1
* Features tested: NEVPT2
* Responsible person: L. Freitag
* Comments: DMRG-NEVPT2 and QD-NEVPT2 test for C2H2, CAS(4,4), 2 states
*-------------------------------------------------------------------------------

>> RM -FORCE TEST_QCMAQUIS
>> IF ( $MOLCAS_DRIVER = UNKNOWN_VARIABLE )
>>   EXPORT MOLCAS_DRIVER=molcas
>> ENDIF
>> SHELL $MOLCAS_DRIVER have_feature qcmaquis || touch TEST_QCMAQUIS
>> IF ( -FILE TEST_QCMAQUIS )
>>   EXIT 36
>> ENDIF

&GATEWAY
 coord
 4
 ang
 H   0.0000000000   0.0000000000  -1.6450541782
 C   0.0000000000   0.0000000000  -0.5832481605
 C   0.0000000000   0.0000000000   0.5832481606
 H   0.0000000000   0.0000000000   1.6450541782
 basis=cc-pvdz
 group=NOSYM
 RICD
&SEWARD

&SCF
&DMRGSCF
 ActiveSpaceOptimizer=QCMaquis
OOptimizationSettings
 nactel = 4,0,0
 inactive = 5
     RAS2 = 4
  CIROOT=2,2,1
  Alter
  1 
  1 8 10
  NEVPT2Prep
  SOCC
  2200
  2ud0
EndOOptimizationSettings
DMRGSettings
    nsweeps = 20
    max_bond_dimension = 100
EndDMRGSettings
&MOTRA
Frozen=0
CTonly
Kpq
HDF5

* Test NEVPT2 calculating the RDMs on the fly
&NEVPT2
States=2

* Test the RDM reading feature by rerunning NEVPT2 with RDMRead option
&NEVPT2
States=2
RDMRead

* Test the distributed 4-RDM calculation
* Perform the RDM calculations without the queue manager
>> EXEC mv $CurrDir/$Project.checkpoint_state.0.0.0.h5 $WorkDir
>> EXEC mv $CurrDir/$Project.checkpoint_state.1.0.0.h5 $WorkDir

>> EXEC $MOLCAS/Tools/distributed-4rdm/prepare_rdm_template.sh
>> EXEC $MOLCAS/Tools/distributed-4rdm/prepare_rdm_template.sh -3
>> SHELL sh -c 'cd $WorkDir/4rdm-scratch.0 && ./jobmanager.py -n'
>> SHELL sh -c 'cd $WorkDir/4rdm-scratch.0/parts && for i in *; do cd $i && sh submit-4rdm.sh && cd ..; done'
>> SHELL sh -c 'cd $WorkDir/4rdm-scratch.1 && ./jobmanager.py -n'
>> SHELL sh -c 'cd $WorkDir/4rdm-scratch.1/parts && for i in *; do cd $i && sh submit-4rdm.sh && cd ..; done'
>> SHELL sh -c 'cd $WorkDir/3rdm-scratch.0.1 && ./jobmanager.py -3 -n'
>> SHELL sh -c 'cd $WorkDir/3rdm-scratch.0.1/parts && for i in *; do cd $i && sh submit-3rdm.sh && cd ..; done'
* Test reading distributed 4-RDM

&NEVPT2
States=2
DistributedRDM
$WorkDir
>>FILE checkfile
* This file is autogenerated:
* Molcas version 7c57cb2a6.
* Linux tp 5.7.9-1-MANJARO #1 SMP PREEMPT Thu Jul 16 08:20:05 UTC 2020 x86_64 GNU/Linux
* Tue Aug 11 18:34:07 2020
*
#>>   1
#> POTNUC="25.322375914149"/12
#>>   2
#> POTNUC="25.322375914149"/12
#> SEWARD_MLTPL1X="0.0"/5
#> SEWARD_KINETIC="0.499289232500"/5
#> SEWARD_ATTRACT="-5.412381512552"/5
#>>   3
#> SCF_ITER="8"/8
#> E_SCF="-76.824481549254"/4
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="0.0"/2
#> MLTPL__1[1]="0.0"/2
#> MLTPL__1[2]="0.000000140219"/2
#> MLTPL__2[0]="-2.488418240736"/2
#> MLTPL__2[1]="0.0"/2
#> MLTPL__2[2]="0.0"/2
#> MLTPL__2[3]="-2.488418240740"/2
#> MLTPL__2[4]="0.0"/2
#> MLTPL__2[5]="4.976836481476"/2
#>>   4
#> RASSCF_ITER="9"/8
#> E_RASSCF[0]="-76.879930774879"/6
#> E_RASSCF[1]="-76.575755760088"/6
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="0.0"/2
#> MLTPL__1[1]="0.0"/2
#> MLTPL__1[2]="-0.000000000901"/2
#> MLTPL__2[0]="-2.391597381481"/2
#> MLTPL__2[1]="0.0"/2
#> MLTPL__2[2]="0.0"/2
#> MLTPL__2[3]="-2.391597381482"/2
#> MLTPL__2[4]="0.0"/2
#> MLTPL__2[5]="4.783194762964"/2
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="0.0"/2
#> MLTPL__1[1]="0.0"/2
#> MLTPL__1[2]="-0.000000001174"/2
#> MLTPL__2[0]="-1.632328161859"/2
#> MLTPL__2[1]="-0.000000000000"/2
#> MLTPL__2[2]="0.0"/2
#> MLTPL__2[3]="-1.632328162031"/2
#> MLTPL__2[4]="0.0"/2
#> MLTPL__2[5]="3.264656323891"/2
#>>   5
#>>   6
#> E_SC_NEVPT2[0]="-77.074185524011"/6
#> E_SC_NEVPT2[1]="0.000000000000"/6
#> E_PC_NEVPT2[0]="-77.074413555838"/6
#> E_PC_NEVPT2[1]="0.000000000000"/6
#>>   7
#> E_SC_NEVPT2[0]="-77.074185524011"/6
#> E_SC_NEVPT2[1]="0.000000000000"/6
#> E_PC_NEVPT2[0]="-77.074413555838"/6
#> E_PC_NEVPT2[1]="0.000000000000"/6
#>>   8
#> E_SC_NEVPT2[0]="-77.074185524011"/6
#> E_SC_NEVPT2[1]="0.000000000000"/6
#> E_PC_NEVPT2[0]="-77.074413555838"/6
#> E_PC_NEVPT2[1]="0.000000000000"/6
>>EOF
