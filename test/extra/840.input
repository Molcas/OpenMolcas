*-------------------------------------------------------------------------------
* Molecule: Acrolein
* Basis: ANO-R1
* Symmetry: C1
* Features tested: CASSCF,RASSI,HDF5,mort
* Responsible person: I. Fdez. GalvÃ¡n
*-------------------------------------------------------------------------------

* Skip the test if mort is not available
> IF ( -FILE $MOLCAS/Tools/mort/mort.py )
>   GOTO HAVE_MORT
> ENDIF
> EXIT 36
> LABEL HAVE_MORT
> SHELL sh create_test_numpy_h5py $MOLCAS/Tools/mort/mort.py
> SHELL ./test_numpy_h5py.py || touch TEST_NUMPY_H5PY
> IF ( -FILE TEST_NUMPY_H5PY )
>   EXIT 36
> ENDIF

* Suppose excited states are computed with the wrong orientation and atom order
* (first with minimal basis)
&GATEWAY
  Coord = 8

    C       1.769114    0.000000    0.136549
    C       0.588145    0.000000   -0.434423
    C      -0.695203    0.000000    0.361447
    O      -1.808864    0.000000   -0.137998
    H      -0.548852    0.000000    1.455362
    H       0.477859    0.000000   -1.512556
    H       2.688665    0.000000   -0.434186
    H       1.880903    0.000000    1.213924
  Basis = STO-3G
  Group = NoSym
  RICD

&SEWARD

&RASSCF
  File = $Project.guessorb.h5
  Alter = 1 ; 1 11 13
  Spin = 1
  Charge = 0
  NActEl = 6
  RAS2 = 5
  StAverage = 4

* Expand basis
&GATEWAY
  Coord = $Project.rasscf.h5
  Basis = ANO-R1
  Group = NoSym
  RICD

&SEWARD

> Exec $MOLCAS/Tools/mort/mort.py -f all $Project.rasscf.h5 $Project.guessorb.h5

&RASSCF
  File = $Project.guessorb.h5
  Spin = 1
  Charge = 0
  NActEl = 6
  RAS2 = 5
  CIRoot = 3 4 ; 2 3 4 ; 1 1 1

> Copy $Project.rasscf.h5 $Project.ES.h5

* This is the correct geometry we want to use for RASSI
&GATEWAY
  Coord = 8

    O      -1.808864   -0.137998    0.000000
    C       1.769114    0.136549    0.000000
    C       0.588145   -0.434423    0.000000
    C      -0.695203    0.361447    0.000000
    H      -0.548852    1.455362    0.000000
    H       0.477859   -1.512556    0.000000
    H       2.688665   -0.434186    0.000000
    H       1.880903    1.213924    0.000000
  Basis = ANO-R1
  Group = NoSym
  RICD

&SEWARD

&RASSCF
  File = $Project.guessorb.h5
  Alter = 2 ; 1 10 14 ; 1 13 15
  Spin = 1
  Charge = 0
  NActEl = 4
  RAS2 = 4
* CIOnly run to make sure the n orbital stays in the active space
&RASSCF
  File = $Project.rasscf.h5
  CIOnly
  Spin = 1
  Charge = 0
  NActEl = 6
  RAS2 = 5

> Copy $Project.rasscf.h5 $Project.GS.h5

* Rotate and reorder the ES file to match the GS
> Copy $Project.GS.h5 JOB001
> Exec $MOLCAS/Tools/mort/mort.py -x 4,1,2,3,5,6,7,8 -r 1 0 0 0 0 1 0 1 0 $Project.ES.h5 JOB002
&RASSI
  NrOfJob = 2 all
  TRD1

>>FILE create_test_numpy_h5py
head -n 1 $1 > test_numpy_h5py.py
echo "import numpy" >> test_numpy_h5py.py
echo "import h5py" >> test_numpy_h5py.py
chmod +x test_numpy_h5py.py
>>EOF

>>FILE checkfile
* This file is autogenerated:
* Molcas version 25.10-141-g62b67eb38
* Linux lucia 6.8.0-90-generic #91~22.04.1-Ubuntu SMP PREEMPT_DYNAMIC Thu Nov 20 15:20:45 UTC 2 x86_64 x86_64 x86_64 GNU/Linux
* Mon Jan 12 08:13:23 2026
*
#>>   1
#> POTNUC="102.496889872072"/12
#>>   2
#> POTNUC="102.496889872072"/12
#> SEWARD_MLTPL1X="3.493377298267"/5
#> SEWARD_KINETIC="15.891121812396"/5
#> SEWARD_ATTRACT="-39.964594306588"/5
#>>   3
#> RASSCF_ITER="12"/8
#> E_RASSCF[0]="-188.387720899373"/4
#> E_RASSCF[1]="-188.253040574024"/4
#> E_RASSCF[2]="-188.108560906394"/4
#> E_RASSCF[3]="-188.063693937059"/4
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="0.619356429994"/2
#> MLTPL__1[1]="0.0"/2
#> MLTPL__1[2]="0.198907226877"/2
#> MLTPL__2[0]="-2.269767644536"/2
#> MLTPL__2[1]="0.0"/2
#> MLTPL__2[2]="-0.679828445359"/2
#> MLTPL__2[3]="0.418611475190"/2
#> MLTPL__2[4]="0.0"/2
#> MLTPL__2[5]="1.851156169346"/2
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="0.256051818132"/2
#> MLTPL__1[1]="0.0"/2
#> MLTPL__1[2]="0.181487962580"/2
#> MLTPL__2[0]="-1.572836778759"/2
#> MLTPL__2[1]="0.0"/2
#> MLTPL__2[2]="-1.048274956544"/2
#> MLTPL__2[3]="-0.934146672773"/2
#> MLTPL__2[4]="0.0"/2
#> MLTPL__2[5]="2.506983451532"/2
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="0.153787889608"/2
#> MLTPL__1[1]="0.0"/2
#> MLTPL__1[2]="0.180357563006"/2
#> MLTPL__2[0]="-1.345672502994"/2
#> MLTPL__2[1]="0.0"/2
#> MLTPL__2[2]="-1.142993368022"/2
#> MLTPL__2[3]="-0.887910467815"/2
#> MLTPL__2[4]="0.000000000000"/2
#> MLTPL__2[5]="2.233582970809"/2
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="0.632657016097"/2
#> MLTPL__1[1]="0.0"/2
#> MLTPL__1[2]="0.054950635399"/2
#> MLTPL__2[0]="-2.359162907727"/2
#> MLTPL__2[1]="0.0"/2
#> MLTPL__2[2]="-1.221137534615"/2
#> MLTPL__2[3]="0.667041523133"/2
#> MLTPL__2[4]="-0.000000000000"/2
#> MLTPL__2[5]="1.692121384594"/2
#>>   4
#> POTNUC="102.496889872072"/12
#>>   5
#> SEWARD_MLTPL1X="3.493377298267"/5
#> SEWARD_KINETIC="23350.035000000014"/5
#> SEWARD_ATTRACT="-1200.876109041756"/5
#> POTNUC="102.496889872072"/12
#> SEWARD_MLTPL1X="3.493377298267"/5
#> SEWARD_KINETIC="16.117924744635"/5
#> SEWARD_ATTRACT="-40.366510068953"/5
#>>   6
#> RASSCF_ITER="12"/8
#> E_RASSCF[0]="-190.828787787907"/4
#> E_RASSCF[1]="-190.704011940239"/4
#> E_RASSCF[2]="-190.674944178298"/4
#> MLTPL__0="-0.000000000001"/2
#> MLTPL__1[0]="1.005881728897"/2
#> MLTPL__1[1]="0.000000030760"/2
#> MLTPL__1[2]="0.303662371554"/2
#> MLTPL__2[0]="-2.161452099015"/2
#> MLTPL__2[1]="0.000000065341"/2
#> MLTPL__2[2]="-0.423764744484"/2
#> MLTPL__2[3]="-0.686978345962"/2
#> MLTPL__2[4]="0.000000085963"/2
#> MLTPL__2[5]="2.848430444977"/2
#> MLTPL__0="-0.000000000001"/2
#> MLTPL__1[0]="0.361793429247"/2
#> MLTPL__1[1]="0.000000026687"/2
#> MLTPL__1[2]="0.219018948491"/2
#> MLTPL__2[0]="-0.973093107936"/2
#> MLTPL__2[1]="0.000000108710"/2
#> MLTPL__2[2]="-0.962019329347"/2
#> MLTPL__2[3]="-2.599501780127"/2
#> MLTPL__2[4]="0.000000087858"/2
#> MLTPL__2[5]="3.572594888063"/2
#> MLTPL__0="-0.000000000001"/2
#> MLTPL__1[0]="0.311448062189"/2
#> MLTPL__1[1]="0.000000037419"/2
#> MLTPL__1[2]="0.237911685880"/2
#> MLTPL__2[0]="-1.085357039743"/2
#> MLTPL__2[1]="0.000000181013"/2
#> MLTPL__2[2]="-1.255924667896"/2
#> MLTPL__2[3]="-2.280661984890"/2
#> MLTPL__2[4]="0.000000136830"/2
#> MLTPL__2[5]="3.366019024634"/2
#> MLTPL__0="-0.000000000001"/2
#> MLTPL__1[0]="0.779420371863"/2
#> MLTPL__1[1]="0.000000037999"/2
#> MLTPL__1[2]="0.032865834469"/2
#> MLTPL__2[0]="-1.735811650732"/2
#> MLTPL__2[1]="0.000000138059"/2
#> MLTPL__2[2]="-1.368843119448"/2
#> MLTPL__2[3]="-0.758610966679"/2
#> MLTPL__2[4]="0.000000138259"/2
#> MLTPL__2[5]="2.494422617411"/2
#>>   7
#> POTNUC="102.496889872072"/12
#>>   8
#> SEWARD_MLTPL1X="-3.268021206256"/5
#> SEWARD_KINETIC="90135.945000000007"/5
#> SEWARD_ATTRACT="-3134.607880329441"/5
#> POTNUC="102.496889872072"/12
#> SEWARD_MLTPL1X="-3.268021206256"/5
#> SEWARD_KINETIC="29.405679010787"/5
#> SEWARD_ATTRACT="-66.844492397528"/5
#>>   9
#> RASSCF_ITER="17"/8
#> E_RASSCF="-190.977709054882"/4
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="1.103190797796"/2
#> MLTPL__1[1]="0.306217824449"/2
#> MLTPL__1[2]="0.000000132901"/2
#> MLTPL__2[0]="-2.472973343415"/2
#> MLTPL__2[1]="-0.868659715010"/2
#> MLTPL__2[2]="-0.000000687393"/2
#> MLTPL__2[3]="3.090691919443"/2
#> MLTPL__2[4]="0.000000273638"/2
#> MLTPL__2[5]="-0.617718576028"/2
#>>  10
#> E_RASSCF="-190.977891069167"/4
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="1.102068927904"/2
#> MLTPL__1[1]="0.305898885968"/2
#> MLTPL__1[2]="0.000000135183"/2
#> MLTPL__2[0]="-2.470716700890"/2
#> MLTPL__2[1]="-0.868248860021"/2
#> MLTPL__2[2]="-0.000000655488"/2
#> MLTPL__2[3]="3.090974001701"/2
#> MLTPL__2[4]="0.000000189840"/2
#> MLTPL__2[5]="-0.620257300812"/2
#>>  11
#> E_RASSI[0]="-190.977941030854"/4
#> E_RASSI[1]="-190.828787787903"/4
#> E_RASSI[2]="-190.704011940235"/4
#> E_RASSI[3]="-190.674890792467"/4
#> TMS(SF,LEN)="0.000026073661"/6
#> TMS(SF,LEN)="0.000432353925"/6
#> TMS(SF,LEN)="0.008316825331"/6
#> TMS(SF,LEN)="0.002605012759"/6
#> TMS(SF,LEN)="0.000000176943"/6
#> TMS(SF,LEN)="0.000006453621"/6
#> TMS(SF,VEL)="0.000000135885"/6
#> TMS(SF,VEL)="0.000299273573"/6
#> TMS(SF,VEL)="0.005193264463"/6
#> TMS(SF,VEL)="0.002616134396"/6
#> TMS(SF,VEL)="0.000001748805"/6
#> TMS(SF,VEL)="0.000149788315"/6
>>EOF
